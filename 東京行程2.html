<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>東京 & 野澤溫泉 2026 - 深度互動行程</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0;
        }
        .glass-panel {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(148, 163, 184, 0.15);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .map-canvas-container {
            background-image: radial-gradient(#334155 1px, transparent 1px);
            background-size: 24px 24px;
            background-color: #0f172a;
        }
        
        /* Custom Range Slider */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 24px;
            width: 24px;
            border-radius: 50%;
            background: #38bdf8;
            cursor: pointer;
            margin-top: -10px; 
            border: 2px solid #0f172a;
            box-shadow: 0 0 10px rgba(56, 189, 248, 0.8);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #334155;
            border-radius: 2px;
        }

        /* Type Badges */
        .badge-transport { background-color: rgba(59, 130, 246, 0.2); color: #93c5fd; border: 1px solid rgba(59, 130, 246, 0.3); }
        .badge-activity { background-color: rgba(16, 185, 129, 0.2); color: #6ee7b7; border: 1px solid rgba(16, 185, 129, 0.3); }
        .badge-food { background-color: rgba(245, 158, 11, 0.2); color: #fcd34d; border: 1px solid rgba(245, 158, 11, 0.3); }
        .badge-hotel { background-color: rgba(139, 92, 246, 0.2); color: #c4b5fd; border: 1px solid rgba(139, 92, 246, 0.3); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        const { Train, MapPin, Utensils, BedDouble, ShoppingBag, Plane, Car, Info } = lucide;

        // --- 2026 Updated Itinerary Data ---
        const itineraryData = [
            {
                id: 1,
                date: "2026-02-15",
                day: "週日",
                title: "抵達東京 & 上野過境",
                summary: "傍晚抵達，快速入住上野，探索阿美橫丁與玩具聖地。",
                locations: ["Narita", "Ueno"],
                stay: "相鐵 Fresa Inn 上野御徒町",
                highlights: ["Yamashiroya 玩具店", "阿美橫丁"],
                transport_type: "train",
                schedule: [
                    { time: "16:30", endTime: "17:30", type: "transport", name: "入境審查 & 領取行李", desc: "成田機場 T1/T2" },
                    { time: "17:39", endTime: "18:23", type: "transport", name: "Skyliner 60號", desc: "成田 T1 -> 京成上野 (推薦班次)", route: "44分" },
                    { time: "17:59", endTime: "18:43", type: "transport", name: "Skyliner 62號", desc: "成田 T1 -> 京成上野", route: "44分" },
                    { time: "18:30", endTime: "19:00", type: "hotel", name: "飯店 Check-in", desc: "相鐵 Fresa Inn 上野御徒町 (由御徒町站步行3分)" },
                    { time: "19:00", endTime: "20:30", type: "food", name: "阿美橫丁晚餐", desc: "推薦：鐵火丼、壽司郎或 Atre 內牛舌根岸" },
                    { time: "20:30", endTime: "21:30", type: "activity", name: "Yamashiroya 玩具店", desc: "上野站對面，六層樓玩具聖殿 (營業至21:30)" },
                    { time: "22:00", endTime: "23:00", type: "hotel", name: "休息", desc: "準備明日早起前往滑雪場" },
                ]
            },
            {
                id: 2,
                date: "2026-02-16",
                day: "週一",
                title: "前進雪國：野澤溫泉",
                summary: "搭乘北陸新幹線轉乘巴士，午後開始租賃裝備與初滑。",
                locations: ["Ueno", "Iiyama", "Nozawa"],
                stay: "野澤溫泉旅館",
                highlights: ["新幹線 Hakutaka", "Haus St. Anton", "麻釜溫泉蛋"],
                transport_type: "shinkansen",
                schedule: [
                    { time: "07:30", endTime: "07:50", type: "hotel", name: "退房 & 移動", desc: "前往 JR 上野站新幹線月台" },
                    { time: "07:58", endTime: "09:39", type: "transport", name: "Hakutaka 553號", desc: "上野 -> 飯山 (最佳平衡班次)", route: "1h 41m", recommended: true },
                    { time: "09:50", endTime: "10:15", type: "transport", name: "Nozawa Onsen Liner", desc: "飯山站 4號月台 -> 野澤溫泉", route: "25分" },
                    { time: "10:30", endTime: "11:00", type: "hotel", name: "旅館寄放行李", desc: "聯絡旅館接駁或步行至民宿" },
                    { time: "11:00", endTime: "12:30", type: "activity", name: "雪具租賃 @ St. Anton", desc: "日影滑雪場入口，高階裝備與寄放服務" },
                    { time: "12:30", endTime: "13:30", type: "food", name: "午餐時間", desc: "推薦：溫泉街蕎麥麵或滑雪場食堂" },
                    { time: "14:00", endTime: "16:00", type: "activity", name: "下午滑雪 / 村內散策", desc: "適應雪況或參觀麻釜 (Ogama)" },
                    { time: "18:00", endTime: "20:00", type: "food", name: "晚餐 (需預約)", desc: "推薦：Kawahiro (壽喜燒) 或 Tanuki" },
                ]
            },
            {
                id: 3,
                date: "2026-02-17 ~ 19",
                day: "週二~四",
                title: "野澤溫泉全日滑雪",
                summary: "沉浸在粉雪天堂，享受滑雪與外湯巡禮。",
                locations: ["Nozawa"],
                stay: "野澤溫泉旅館",
                highlights: ["長坂纜車", "日影滑雪場", "外湯巡禮"],
                transport_type: "ski",
                schedule: [
                    { time: "08:00", endTime: "08:30", type: "transport", name: "長坂纜車運行開始", desc: "前往山頂毛無山區域", route: "纜車" },
                    { time: "09:00", endTime: "12:00", type: "activity", name: "上午滑雪", desc: "推薦路線：上之平 (初中級) / Skyline (中高級)" },
                    { time: "12:00", endTime: "13:00", type: "food", name: "山頂午餐", desc: "Rest House Yamabiko (必吃野澤菜牛排飯)" },
                    { time: "13:00", endTime: "16:00", type: "activity", name: "下午滑雪", desc: "挑戰粉雪或林間道" },
                    { time: "16:30", endTime: "17:30", type: "activity", name: "外湯巡禮", desc: "大湯 (Oyu) 或 松葉之湯" },
                    { time: "18:00", endTime: "20:00", type: "food", name: "晚餐時光", desc: "Trattoria Bivacco (義式) *需提前30天搶訂" },
                ]
            },
            {
                id: 4,
                date: "2026-02-20",
                day: "週五",
                title: "返回東京 & 八丁堀入住",
                summary: "告別雪國，移動至東京八丁堀公寓式酒店，享受都會便利。",
                locations: ["Nozawa", "Iiyama", "Ueno", "Hatchobori"],
                stay: "MIMARU 東京八丁堀",
                highlights: ["MIMARU 公寓酒店", "Maruetsu 超市"],
                transport_type: "shinkansen",
                schedule: [
                    { time: "09:00", endTime: "09:30", type: "hotel", name: "退房", desc: "結算與行李整理" },
                    { time: "09:40", endTime: "10:05", type: "transport", name: "Nozawa Onsen Liner", desc: "野澤 -> 飯山站", route: "25分" },
                    { time: "10:28", endTime: "12:13", type: "transport", name: "Hakutaka 556號", desc: "飯山 -> 上野", route: "1h 45m" },
                    { time: "12:30", endTime: "13:30", type: "food", name: "上野午餐", desc: "上野站 Atre 或 ecute 內用餐" },
                    { time: "13:40", endTime: "14:00", type: "transport", name: "日比谷線", desc: "上野 -> 八丁堀 (直達)", route: "12分" },
                    { time: "15:00", endTime: "16:00", type: "hotel", name: "MIMARU Check-in", desc: "公寓式酒店，適合整理滑雪裝備" },
                    { time: "17:00", endTime: "18:00", type: "activity", name: "超市採買", desc: "Maruetsu Petit (飯店對面) 採買早餐食材" },
                    { time: "18:30", endTime: "20:00", type: "food", name: "晚餐", desc: "附近推薦：Shellfish Specialty Kaiyahokuto (貝料理)" },
                ]
            },
            {
                id: 5,
                date: "2026-02-21",
                day: "週六",
                title: "分眾行程：動漫 & 高爾夫",
                summary: "兵分兩路：台場鋼彈/秋葉原 vs 銀座高爾夫球具採購。",
                locations: ["Hatchobori", "Odaiba", "Akihabara", "Ginza"],
                stay: "MIMARU 東京八丁堀",
                highlights: ["Gundam Base", "Radio Kaikan", "Double Eagle Ginza"],
                transport_type: "metro",
                schedule: [
                    { time: "09:00", endTime: "10:00", type: "transport", name: "出發移動", desc: "A組往台場 / B組往銀座" },
                    { time: "10:00", endTime: "13:00", type: "activity", name: "[青少年] Gundam Base", desc: "台場 DiverCity (需事前抽選入場)", recommended: true },
                    { time: "11:00", endTime: "13:00", type: "activity", name: "[成人] Double Eagle", desc: "銀座高爾夫精品店 (需預約 Fitting)" },
                    { time: "13:00", endTime: "14:00", type: "food", name: "各自午餐", desc: "台場美食街 / 銀座周邊" },
                    { time: "14:00", endTime: "18:00", type: "activity", name: "[青少年] 秋葉原", desc: "Radio 會館、AmiAmi、Mandarake" },
                    { time: "14:00", endTime: "18:00", type: "activity", name: "[成人] Victoria Golf", desc: "神田小川町旗艦店 (免稅+折扣)" },
                    { time: "19:00", endTime: "21:00", type: "food", name: "會合晚餐", desc: "八丁堀/銀座周邊慶功宴" },
                ]
            },
            {
                id: 6,
                date: "2026-02-22",
                day: "週日",
                title: "包車返程",
                summary: "滿載戰利品，搭乘包車直達成田機場。",
                locations: ["Hatchobori", "Narita"],
                stay: "溫暖的家",
                highlights: ["Toyota Hiace 包車", "最後補貨"],
                transport_type: "car",
                schedule: [
                    { time: "08:00", endTime: "10:00", type: "food", name: "房內早餐 & 打包", desc: "享用超市購買的水果/麵包" },
                    { time: "10:00", endTime: "10:30", type: "hotel", name: "退房手續", desc: "大廳等候包車" },
                    { time: "13:00", endTime: "15:00", type: "transport", name: "包車前往機場", desc: "Toyota Hiace/Alphard 直達成田", route: "90-120分", recommended: true },
                    { time: "15:00", endTime: "16:00", type: "activity", name: "機場報到 & 免稅店", desc: "成田機場 T1/T2" },
                    { time: "17:00", endTime: "17:30", type: "transport", name: "返程班機", desc: "再見東京！" },
                ]
            },
        ];

        // Coordinates for Map Visualization (Relative 0-100 scale)
        const mapCoords = {
            Narita: { x: 85, y: 80, label: "成田機場" },
            Ueno: { x: 60, y: 75, label: "上野" },
            Hatchobori: { x: 62, y: 78, label: "八丁堀" },
            TokyoStn: { x: 60, y: 80, label: "東京站" },
            Odaiba: { x: 62, y: 85, label: "台場" },
            Akihabara: { x: 60, y: 72, label: "秋葉原" },
            Ginza: { x: 58, y: 79, label: "銀座" },
            Iiyama: { x: 30, y: 30, label: "飯山站" },
            Nozawa: { x: 35, y: 20, label: "野澤溫泉" },
        };

        // Helper: Parse time string "HH:MM" to minutes
        const timeToMins = (timeStr) => {
            const [h, m] = timeStr.split(":").map(Number);
            return h * 60 + m;
        };

        const minsToTime = (mins) => {
            let h = Math.floor(mins / 60);
            let m = mins % 60;
            if (h >= 24) h -= 24;
            return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
        };

        const getTypeIcon = (type) => {
            switch(type) {
                case 'transport': return <Train size={18} />;
                case 'food': return <Utensils size={18} />;
                case 'activity': return <MapPin size={18} />;
                case 'hotel': return <BedDouble size={18} />;
                case 'car': return <Car size={18} />;
                default: return <Info size={18} />;
            }
        };

        const getTypeColor = (type) => {
            switch(type) {
                case 'transport': return 'badge-transport';
                case 'food': return 'badge-food';
                case 'activity': return 'badge-activity';
                case 'hotel': return 'badge-hotel';
                case 'car': return 'badge-transport'; // Reusing transport color for car
                default: return 'text-gray-400 border-gray-700';
            }
        };

        // Component: Timeline Slider
        const TimeSlider = ({ currentTime, setTime }) => {
            return (
                <div className="p-5 glass-panel rounded-xl mb-4 shadow-lg">
                    <div className="flex justify-between items-end mb-3">
                        <div className="flex flex-col">
                            <span className="text-sky-300 text-xs font-bold tracking-wider uppercase mb-1">Current Time</span>
                            <span className="text-4xl font-bold text-white font-mono tracking-tight drop-shadow-md">{minsToTime(currentTime)}</span>
                        </div>
                        <div className="text-right">
                            <span className="text-xs text-gray-400">拖動滑桿預覽行程</span>
                        </div>
                    </div>
                    <input 
                        type="range" 
                        min="360" // 06:00
                        max="1440" // 24:00
                        step="15"
                        value={currentTime} 
                        onChange={(e) => setTime(parseInt(e.target.value))}
                        className="w-full"
                    />
                    <div className="flex justify-between text-xs text-gray-500 mt-2 font-mono">
                        <span>06:00</span>
                        <span>12:00</span>
                        <span>18:00</span>
                        <span>24:00</span>
                    </div>
                </div>
            );
        };

        // Component: Upcoming Schedule
        const UpcomingSchedule = ({ schedule, currentTime }) => {
            const windowSize = 180; // Show 3 hours ahead for better visibility of activities
            
            const filtered = schedule.filter(item => {
                const itemTime = timeToMins(item.time);
                // Show items that start within the window OR are currently ongoing
                const itemEndTime = item.endTime ? timeToMins(item.endTime) : itemTime + 60;
                return (itemTime >= currentTime && itemTime <= currentTime + windowSize) || 
                       (itemTime <= currentTime && itemEndTime >= currentTime);
            });

            return (
                <div className="glass-panel rounded-xl p-0 h-full flex flex-col overflow-hidden shadow-lg">
                    <div className="p-4 border-b border-slate-700/50 bg-slate-800/30">
                        <h3 className="text-lg font-bold flex items-center gap-2 text-sky-100">
                            <Info size={20} className="text-sky-400" />
                            即時行程動態
                        </h3>
                        <p className="text-xs text-gray-400 mt-1">顯示當前與未來3小時內的活動</p>
                    </div>
                    
                    <div className="overflow-y-auto flex-1 p-4 space-y-3 custom-scrollbar">
                        {filtered.length === 0 ? (
                            <div className="flex flex-col items-center justify-center h-40 text-gray-500 space-y-2">
                                <BedDouble size={32} className="opacity-20" />
                                <span className="text-sm italic">此時段暫無安排或為休息時間</span>
                            </div>
                        ) : (
                            filtered.map((item, idx) => {
                                const isHappeningNow = timeToMins(item.time) <= currentTime && timeToMins(item.endTime || item.time) >= currentTime;
                                return (
                                    <div key={idx} className={`relative p-4 rounded-xl border transition-all duration-300 ${
                                        isHappeningNow 
                                        ? 'bg-slate-700/60 border-sky-500/50 shadow-lg scale-[1.02] z-10' 
                                        : 'bg-slate-800/40 border-slate-700 hover:bg-slate-800/60'
                                    }`}>
                                        {isHappeningNow && (
                                            <div className="absolute top-2 right-2 flex h-2 w-2">
                                                <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-sky-400 opacity-75"></span>
                                                <span className="relative inline-flex rounded-full h-2 w-2 bg-sky-500"></span>
                                            </div>
                                        )}
                                        <div className="flex items-start gap-3">
                                            <div className={`p-2 rounded-lg ${getTypeColor(item.type)}`}>
                                                {getTypeIcon(item.type)}
                                            </div>
                                            <div className="flex-1 min-w-0">
                                                <div className="flex justify-between items-center mb-1">
                                                    <span className="text-sm font-mono text-sky-200 font-bold">
                                                        {item.time} <span className="text-gray-500 font-normal text-xs">- {item.endTime}</span>
                                                    </span>
                                                    {item.recommended && <span className="bg-red-500/20 text-red-300 border border-red-500/30 text-[10px] px-2 py-0.5 rounded-full font-medium">推薦</span>}
                                                </div>
                                                <div className="font-bold text-white text-base truncate">{item.name}</div>
                                                <div className="text-sm text-gray-400 mt-1 leading-relaxed">{item.desc}</div>
                                                {item.route && (
                                                    <div className="mt-2 inline-flex items-center gap-1 text-xs text-slate-400 bg-slate-800 px-2 py-1 rounded border border-slate-700">
                                                        <span>⏱ 行程耗時: {item.route}</span>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                );
                            })
                        )}
                    </div>
                </div>
            );
        };

        // Component: Map Canvas
        const MapCanvas = ({ dayData }) => {
            const canvasRef = useRef(null);
            const animationRef = useRef(null);

            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                
                // Resize handler
                const resize = () => {
                    const parent = canvas.parentElement;
                    canvas.width = parent.clientWidth;
                    canvas.height = parent.clientHeight;
                };
                resize();
                window.addEventListener('resize', resize);

                // Drawing loop
                let progress = 0;
                
                const drawMap = () => {
                    const w = canvas.width;
                    const h = canvas.height;
                    
                    ctx.clearRect(0, 0, w, h);

                    // Draw Grid
                    // handled by CSS container

                    // 3. Draw Active Route
                    const activeLocs = dayData.locations;
                    
                    if (activeLocs.length > 1) {
                        // Draw Path Line
                        ctx.beginPath();
                        ctx.strokeStyle = "rgba(56, 189, 248, 0.3)"; // Faint Blue
                        ctx.lineWidth = 4;
                        ctx.setLineCap("round");
                        
                        ctx.moveTo(mapCoords[activeLocs[0]].x * w / 100, mapCoords[activeLocs[0]].y * h / 100);
                        for(let i=1; i<activeLocs.length; i++) {
                            const target = mapCoords[activeLocs[i]];
                            ctx.lineTo(target.x * w / 100, target.y * h / 100);
                        }
                        ctx.stroke();

                        // Animate Moving Dot
                        const totalSegments = activeLocs.length - 1;
                        const segmentProgress = (Date.now() / 2500) % totalSegments; 
                        const currentSegmentIdx = Math.floor(segmentProgress);
                        const t = segmentProgress - currentSegmentIdx;

                        const startNode = mapCoords[activeLocs[currentSegmentIdx]];
                        const endNode = mapCoords[activeLocs[currentSegmentIdx + 1]];

                        if (startNode && endNode) {
                            const curX = startNode.x + (endNode.x - startNode.x) * t;
                            const curY = startNode.y + (endNode.y - startNode.y) * t;

                            // Ripple effect
                            const rippleSize = (Date.now() % 1000) / 1000;
                            ctx.beginPath();
                            ctx.arc(curX * w / 100, curY * h / 100, 8 + (rippleSize * 20), 0, Math.PI * 2);
                            ctx.strokeStyle = `rgba(56, 189, 248, ${1-rippleSize})`;
                            ctx.lineWidth = 2;
                            ctx.stroke();

                            // Dot
                            ctx.beginPath();
                            ctx.arc(curX * w / 100, curY * h / 100, 6, 0, Math.PI * 2);
                            ctx.fillStyle = "#38bdf8"; 
                            ctx.fill();
                            ctx.shadowColor = "#38bdf8";
                            ctx.shadowBlur = 15;
                        }
                    }

                    // Draw Nodes
                    Object.entries(mapCoords).forEach(([key, val]) => {
                        const isActive = activeLocs.includes(key);
                        const x = val.x * w / 100;
                        const y = val.y * h / 100;

                        // Node Circle
                        ctx.beginPath();
                        ctx.arc(x, y, isActive ? 6 : 3, 0, Math.PI * 2);
                        ctx.fillStyle = isActive ? "#f8fafc" : "#475569";
                        ctx.fill();
                        
                        // Label Background
                        if(isActive) {
                            const textWidth = ctx.measureText(val.label).width;
                            ctx.fillStyle = "rgba(15, 23, 42, 0.8)";
                            ctx.fillRect(x + 10, y - 10, textWidth + 10, 20);
                        }

                        // Label Text
                        ctx.fillStyle = isActive ? "#f8fafc" : "#64748b";
                        ctx.font = isActive ? "bold 14px 'Noto Sans TC'" : "12px 'Noto Sans TC'";
                        ctx.textBaseline = "middle";
                        ctx.fillText(val.label, x + 15, y);
                    });

                    animationRef.current = requestAnimationFrame(drawMap);
                };

                drawMap();

                return () => {
                    window.removeEventListener('resize', resize);
                    cancelAnimationFrame(animationRef.current);
                };
            }, [dayData]);

            return <canvas ref={canvasRef} className="w-full h-full block" />;
        };

        // Main App Component
        const App = () => {
            const [selectedDayId, setSelectedDayId] = useState(2); 
            const [currentTime, setCurrentTime] = useState(480); // 08:00 AM

            const currentDayData = useMemo(() => 
                itineraryData.find(d => d.id === selectedDayId), 
                [selectedDayId]
            );

            // Auto-adjust slider when switching days
            useEffect(() => {
               if(selectedDayId === 1) setCurrentTime(1020); // 17:00
               else if(selectedDayId === 2) setCurrentTime(480); // 08:00
               else setCurrentTime(540); // 09:00
            }, [selectedDayId]);

            return (
                <div className="min-h-screen p-4 md:p-6 max-w-7xl mx-auto flex flex-col gap-4 bg-gradient-to-br from-slate-900 to-slate-950">
                    
                    {/* Header */}
                    <header className="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-2 px-2">
                        <div>
                            <h1 className="text-2xl md:text-4xl font-bold bg-gradient-to-r from-sky-400 via-blue-500 to-indigo-400 bg-clip-text text-transparent tracking-tight">
                                東京 & 野澤溫泉 2026
                            </h1>
                            <p className="text-slate-400 text-sm mt-1 flex items-center gap-2">
                                <span className="bg-slate-800 px-2 py-0.5 rounded text-slate-300 border border-slate-700">2026/02/15 - 02/22</span>
                                <span className="hidden md:inline">|</span>
                                <span className="hidden md:inline">家庭滑雪與購物深度行</span>
                            </p>
                        </div>
                        <div className="flex flex-wrap items-center gap-2 bg-slate-800/50 p-1.5 rounded-xl border border-slate-700/50 backdrop-blur-sm">
                            {itineraryData.map(day => (
                                <button
                                    key={day.id}
                                    onClick={() => setSelectedDayId(day.id)}
                                    className={`px-3 py-2 text-xs md:text-sm rounded-lg transition-all flex flex-col items-center min-w-[60px] ${
                                        selectedDayId === day.id 
                                        ? 'bg-sky-600 text-white font-bold shadow-lg ring-1 ring-sky-400' 
                                        : 'text-gray-400 hover:bg-slate-700 hover:text-white'
                                    }`}
                                >
                                    <span className="opacity-70 text-[10px]">{day.day}</span>
                                    <span>{day.date.slice(8)}日</span>
                                </button>
                            ))}
                        </div>
                    </header>

                    {/* Main Grid */}
                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 flex-1">
                        
                        {/* Left Column: Controls & Timeline (5 cols) */}
                        <div className="lg:col-span-5 flex flex-col gap-4 h-[calc(100vh-160px)] min-h-[600px]">
                            
                            {/* Summary Card */}
                            <div className="glass-panel p-6 rounded-2xl border-t-4 border-sky-500 shadow-2xl">
                                <div className="flex justify-between items-start mb-4">
                                    <div>
                                        <div className="text-sky-400 font-bold text-sm uppercase tracking-widest mb-1">Day {currentDayData.id}</div>
                                        <h2 className="text-2xl font-bold text-white leading-tight">{currentDayData.title}</h2>
                                    </div>
                                    <div className={`p-2 rounded-lg ${getTypeColor(currentDayData.transport_type)}`}>
                                        {getTypeIcon(currentDayData.transport_type)}
                                    </div>
                                </div>
                                <p className="text-slate-300 text-sm leading-relaxed mb-6 border-b border-slate-700/50 pb-4">
                                    {currentDayData.summary}
                                </p>
                                
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="bg-slate-800/50 rounded-lg p-3 border border-slate-700/50">
                                        <div className="flex items-center gap-2 text-indigo-300 text-xs font-bold uppercase mb-1">
                                            <BedDouble size={14} /> 住宿
                                        </div>
                                        <div className="text-sm font-medium text-white truncate" title={currentDayData.stay}>
                                            {currentDayData.stay}
                                        </div>
                                    </div>
                                    <div className="bg-slate-800/50 rounded-lg p-3 border border-slate-700/50">
                                        <div className="flex items-center gap-2 text-emerald-300 text-xs font-bold uppercase mb-1">
                                            <MapPin size={14} /> 重點
                                        </div>
                                        <div className="flex overflow-hidden gap-1">
                                            {currentDayData.highlights.slice(0,2).map((tag, i) => (
                                                <span key={i} className="text-[10px] bg-slate-700 px-1.5 py-0.5 rounded text-slate-200 truncate">{tag}</span>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Slider */}
                            <TimeSlider currentTime={currentTime} setTime={setCurrentTime} />

                            {/* Schedule List */}
                            <div className="flex-1 min-h-0">
                                <UpcomingSchedule schedule={currentDayData.schedule} currentTime={currentTime} />
                            </div>
                        </div>

                        {/* Right Column: Map (7 cols) */}
                        <div className="lg:col-span-7 relative rounded-2xl overflow-hidden border border-slate-700 shadow-2xl h-[calc(100vh-160px)] min-h-[400px]">
                            <div className="absolute inset-0 map-canvas-container">
                                <MapCanvas dayData={currentDayData} />
                            </div>
                            
                            {/* Floating Labels */}
                            <div className="absolute bottom-6 left-6 right-6 pointer-events-none flex justify-center">
                                <div className="bg-slate-900/80 backdrop-blur-md px-4 py-2 rounded-full border border-slate-700/50 text-xs text-slate-400 shadow-xl">
                                    互動地圖 - 顯示當日移動路徑
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>